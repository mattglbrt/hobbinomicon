---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { supabase } from "../../lib/supabase";
import GameDetails from "../../components/GameDetails.astro";

export async function getStaticPaths() {
  const { data: games, error } = await supabase.from("games").select("slug");

  if (error) {
    console.error("Failed to fetch games:", error);
    return [];
  }

  return games.map((game) => ({
    params: { slug: game.slug },
  }));
}

const { slug } = Astro.params;
const { data: game, error } = await supabase
  .from("games")
  .select("*")
  .eq("slug", slug)
  .single();

if (error) {
  console.error("Failed to fetch game:", error);
}
---

<BaseLayout>
  {game ? (
    <GameDetails game={game} />
  ) : (
    <div class="text-center py-24">
      <h2 class="text-2xl font-bold">Game not found.</h2>
    </div>
  )}
</BaseLayout>
