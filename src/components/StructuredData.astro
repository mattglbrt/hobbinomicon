---
/**
 * StructuredData Component
 * Renders JSON-LD structured data for SEO
 * Supports: WebSite, Organization, BlogPosting, BreadcrumbList
 */

interface WebSite {
  '@type': 'WebSite';
  name: string;
  url: string;
  description?: string;
  potentialAction?: {
    '@type': 'SearchAction';
    target: string;
    'query-input': string;
  };
}

interface Organization {
  '@type': 'Organization';
  name: string;
  url: string;
  logo?: string;
  sameAs?: string[];
}

interface BlogPosting {
  '@type': 'BlogPosting';
  headline: string;
  description: string;
  image?: string;
  datePublished: string;
  dateModified?: string;
  author: {
    '@type': 'Person' | 'Organization';
    name: string;
    url?: string;
  };
  publisher: {
    '@type': 'Organization';
    name: string;
    logo?: {
      '@type': 'ImageObject';
      url: string;
    };
  };
  mainEntityOfPage: {
    '@type': 'WebPage';
    '@id': string;
  };
  keywords?: string[];
  articleSection?: string;
  wordCount?: number;
}

interface BreadcrumbItem {
  name: string;
  url: string;
}

interface BreadcrumbList {
  '@type': 'BreadcrumbList';
  itemListElement: {
    '@type': 'ListItem';
    position: number;
    name: string;
    item: string;
  }[];
}

type SchemaType = WebSite | Organization | BlogPosting | BreadcrumbList;

interface Props {
  type: 'website' | 'organization' | 'blogPosting' | 'breadcrumb';
  data: {
    // WebSite
    siteName?: string;
    siteUrl?: string;
    siteDescription?: string;
    // Organization
    orgName?: string;
    orgUrl?: string;
    orgLogo?: string;
    socialLinks?: string[];
    // BlogPosting
    title?: string;
    description?: string;
    image?: string;
    datePublished?: Date;
    dateModified?: Date;
    authorName?: string;
    authorUrl?: string;
    keywords?: string[];
    category?: string;
    wordCount?: number;
    url?: string;
    // Breadcrumb
    breadcrumbs?: BreadcrumbItem[];
  };
}

const { type, data } = Astro.props;

function generateSchema(): SchemaType | null {
  switch (type) {
    case 'website':
      return {
        '@type': 'WebSite',
        name: data.siteName || 'The Hobbinomicon',
        url: data.siteUrl || 'https://hobbinomicon.com',
        description: data.siteDescription || 'Hobbying from the deep end of the dungeon. Miniature painting, TTRPGs, and creative projects.',
      };

    case 'organization':
      return {
        '@type': 'Organization',
        name: data.orgName || 'The Hobbinomicon',
        url: data.orgUrl || 'https://hobbinomicon.com',
        logo: data.orgLogo || 'https://hobbinomicon.com/og-image.jpg',
        sameAs: data.socialLinks || [
          'https://www.youtube.com/@Hobbinomicon',
          'https://twitter.com/hobbinomicon',
        ],
      };

    case 'blogPosting':
      if (!data.title || !data.description || !data.datePublished) {
        return null;
      }
      return {
        '@type': 'BlogPosting',
        headline: data.title,
        description: data.description,
        image: data.image,
        datePublished: data.datePublished.toISOString(),
        dateModified: data.dateModified?.toISOString() || data.datePublished.toISOString(),
        author: {
          '@type': 'Person',
          name: data.authorName || 'Hobbinomicon',
          url: data.authorUrl || 'https://hobbinomicon.com/about',
        },
        publisher: {
          '@type': 'Organization',
          name: 'The Hobbinomicon',
          logo: {
            '@type': 'ImageObject',
            url: 'https://hobbinomicon.com/og-image.jpg',
          },
        },
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': data.url || '',
        },
        keywords: data.keywords,
        articleSection: data.category,
        wordCount: data.wordCount,
      };

    case 'breadcrumb':
      if (!data.breadcrumbs || data.breadcrumbs.length === 0) {
        return null;
      }
      return {
        '@type': 'BreadcrumbList',
        itemListElement: data.breadcrumbs.map((item, index) => ({
          '@type': 'ListItem',
          position: index + 1,
          name: item.name,
          item: item.url,
        })),
      };

    default:
      return null;
  }
}

const schema = generateSchema();
const jsonLd = schema ? {
  '@context': 'https://schema.org',
  ...schema,
} : null;
---

{jsonLd && (
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
)}
