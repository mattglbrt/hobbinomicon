---
import BaseLayout from "../../layouts/BaseLayout.astro";
import "../../styles/global.css";
---

<BaseLayout title="Admin Login">
  <main class="max-w-sm mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold mb-8 text-center">Admin Login</h1>

    <form id="login-form" class="space-y-6">
      <input 
        id="password-input"
        type="password" 
        placeholder="Enter Admin Password"
        class="w-full border rounded px-3 py-2"
        required
      />
      <button type="submit" class="w-full bg-primary text-white font-bold py-2 px-4 rounded hover:bg-primary-dark">
        Login
      </button>
      <div id="error-message" class="text-red-600 text-sm mt-4 hidden text-center"></div>
    </form>
  </main>

  <script type="module">
    const form = document.getElementById('login-form');
    const passwordInput = document.getElementById('password-input');
    const errorMessage = document.getElementById('error-message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = passwordInput.value;

      sessionStorage.setItem("hobbinomiconAdminPassword", password);

      const res = await fetch("/admin/games", {
        headers: {
          Authorization: `Bearer ${password}`,
        },
      });

      if (res.status === 401) {
        errorMessage.textContent = "Incorrect password. Try again.";
        errorMessage.classList.remove('hidden');
        sessionStorage.removeItem("hobbinomiconAdminPassword");
      } else {
        window.location.href = "/admin/games";
      }
    });
  </script>
</BaseLayout>
