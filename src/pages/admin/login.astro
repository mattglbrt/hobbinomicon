---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout title="Admin Login">
  <main class="max-w-md mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold mb-6 text-center">Admin Login</h1>

    <div id="status-message" class="text-center text-sm mb-6"></div>

    <form id="login-form" class="space-y-6">
      <input type="email" name="email" placeholder="Email" required class="w-full border rounded px-3 py-2" />
      <input type="password" name="password" placeholder="Password" required class="w-full border rounded px-3 py-2" />
      <button type="submit" class="w-full bg-primary text-white font-bold py-2 px-4 rounded hover:bg-primary-dark">Log In</button>
    </form>

    <script type="module">
      import { supabase } from '/src/lib/supabase.ts';

      const form = document.getElementById('login-form') as HTMLFormElement;
      const statusMessage = document.getElementById('status-message') as HTMLDivElement;

      form.addEventListener('submit', async (e: Event) => {
        e.preventDefault();
        const formData = new FormData(form);
        const email = formData.get('email') as string;
        const password = formData.get('password') as string;

        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
          statusMessage.textContent = "‚ùå Incorrect login. Please try again.";
          statusMessage.classList.add('text-red-600');
          statusMessage.classList.remove('text-green-600');
        } else {
          window.location.href = '/admin/games'; // login success
        }
      });
    </script>
  </main>
</BaseLayout>
