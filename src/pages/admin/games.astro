---
import { checkAdminAuth } from "../scripts/checkAuth";
import { supabase } from "../lib/supabase";

// Check if user is authenticated
checkAdminAuth();

const { data: games, error } = await supabase.from("games").select("*");

if (error) {
  console.error("Error fetching games:", error);
}
---

<BaseLayout>
  <section class="max-w-7xl mx-auto py-12">
    <h1 class="text-3xl font-bold mb-6">Games Dashboard</h1>
    
    {games ? (
      <table class="w-full table-auto">
        <thead>
          <tr>
            <th class="px-4 py-2">Title</th>
            <th class="px-4 py-2">Genre</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          {games.map(game => (
            <tr key={game.id}>
              <td class="px-4 py-2">{game.title}</td>
              <td class="px-4 py-2">{game.genre}</td>
              <td class="px-4 py-2">
                <a href={`/admin/edit-game/${game.slug}`} class="text-blue-600">Edit</a>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    ) : (
      <p>No games found.</p>
    )}
  </section>
</BaseLayout>
