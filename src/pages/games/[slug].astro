---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { supabase } from "../../lib/supabase";
import "../../styles/global.css";

export async function getStaticPaths() {
  const { data: games, error } = await supabase
    .from('games')
    .select('slug');

  if (error) {
    console.error('Error fetching game slugs:', error.message);
    return [];
  }

  return games.map(game => ({
    params: { slug: game.slug },
  }));
}

const { slug } = Astro.params;

const { data: game, error } = await supabase
  .from('games')
  .select('*')
  .eq('slug', slug)
  .single();

if (error) {
  console.error('Error fetching game:', error.message);
}
---

<BaseLayout title={game?.title || 'Game'}>
  <main class="max-w-4xl mx-auto p-6">
    {game ? (
      <>
        <h1 class="text-4xl font-bold mb-4">{game.title}</h1>
        <p class="mb-6">{game.description}</p>

        <div class="grid grid-cols-2 gap-6">
          <div><strong>Players:</strong> {game.min_players}â€“{game.max_players}</div>
          <div><strong>Play Time:</strong> {game.play_time}</div>
          <div><strong>Age:</strong> {game.age_range}</div>
          <div><strong>Published:</strong> {game.publication_year}</div>
        </div>

        <div class="mt-6">
          <a href={game.official_website} target="_blank" class="text-primary hover:underline">Official Website</a><br/>
          <a href={game.rules_url} target="_blank" class="text-primary hover:underline">Rules</a>
        </div>

        {game.tags?.length > 0 && (
          <div class="mt-6">
            <strong>Tags:</strong> {game.tags.join(', ')}
          </div>
        )}
      </>
    ) : (
      <p>Game not found.</p>
    )}
  </main>
</BaseLayout>
