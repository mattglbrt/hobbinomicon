---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { supabase } from "../../lib/supabase";
import "../../styles/global.css";

const { data: games, error } = await supabase
  .from('games')
  .select('*')
  .order('title', { ascending: true });

if (error) {
  console.error('Error fetching games:', error.message);
}
---

<BaseLayout title="Games Directory">
  <main class="max-w-7xl mx-auto px-4 py-10">
    <h1 class="text-4xl font-bold text-center mb-10">Find a Game</h1>

    <div class="grid gap-8 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
      {games && games.map(game => (
        <a href={`/games/${game.slug}`} class="group block bg-white border rounded-lg overflow-hidden shadow hover:shadow-lg transition">
          {game.cover_image_url && (
            <img 
              src={game.cover_image_url} 
              alt={game.title} 
              class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
            />
          )}
          <div class="p-4">
            <h2 class="text-lg font-bold mb-2 group-hover:text-primary">{game.title}</h2>
            <p class="text-sm text-gray-600 line-clamp-3">{game.description}</p>
          </div>
        </a>
      ))}
    </div>

    {(!games || games.length === 0) && (
      <div class="text-center text-gray-500 mt-10">
        No games found.
      </div>
    )}
  </main>
</BaseLayout>
