---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import PageHeader from '../../components/PageHeader.astro';
import PostCard from '../../components/PostCard.astro';
import Footer from '../../components/Footer.astro';
import { filterDrafts } from '../../utils/filterDrafts';

const allPosts = await getCollection('blog');
const publishedPosts = filterDrafts(allPosts);
const sortedPosts = publishedPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Get unique categories
const categories = [...new Set(publishedPosts.map(post => post.data.category))].sort();
---

<BaseLayout title="Blog - The Hobbinomicon">
  <Header theme="light" />

  <main id="main-content" class="min-h-screen bg-parchment">
    <PageHeader
      title="All Posts"
      description="Exploring hobbies, projects, and creative pursuits"
      backLink={{ href: "/", text: "Back to Home" }}
    />

    <!-- Category Shortcuts -->
    <div class="bg-parchment border-b-2 border-ink/10 py-8">
      <div class="max-w-7xl mx-auto px-6">
        <h2 class="text-lg font-heading font-bold text-ink mb-4">Browse by Category</h2>
        <div class="flex flex-wrap gap-3">
          <a
            href="/categories"
            class="inline-block px-4 py-2 bg-ink text-parchment font-mono text-sm rounded hover:bg-ink/90 transition-colors"
          >
            All Categories
          </a>
          {categories.map((category) => (
            <a
              href={`/categories/${category.toLowerCase().replace(/ /g, '-')}`}
              class="inline-block px-4 py-2 bg-white border-2 border-ink/20 text-ink font-mono text-sm rounded hover:border-ink/40 hover:bg-ink/5 transition-all"
            >
              {category}
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Posts Grid -->
    <div class="max-w-7xl mx-auto px-6 py-16">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedPosts.map((post) => (
          <PostCard
            slug={post.slug}
            title={post.data.title}
            description={post.data.description}
            heroImage={post.data.heroImage}
            heroImageAlt={post.data.heroImageAlt}
            category={post.data.category}
            pubDate={post.data.pubDate}
            tags={post.data.tags}
            youtubeId={post.data.youtubeId}
          />
        ))}
      </div>
    </div>

    <Footer />
  </main>
</BaseLayout>
