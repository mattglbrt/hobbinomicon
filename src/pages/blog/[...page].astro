---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import PageHeader from '../../components/PageHeader.astro';
import CategoryShortcuts from '../../components/CategoryShortcuts.astro';
import ContentContainer from '../../components/ContentContainer.astro';
import PostCard from '../../components/PostCard.astro';
import Pagination from '../../components/Pagination.astro';
import Footer from '../../components/Footer.astro';
import StructuredData from '../../components/StructuredData.astro';
import { getPublishedPosts, getUniqueCategories } from '../../utils/collections';

export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = await getCollection('blog');
  const sortedPosts = getPublishedPosts(allPosts);

  // 12 posts per page (4 rows of 3)
  return paginate(sortedPosts, { pageSize: 12 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

// Get unique categories for the category shortcuts
const allPosts = await getCollection('blog');
const categories = getUniqueCategories(getPublishedPosts(allPosts));

// Build pagination URLs
const baseUrl = '/blog';
const prevUrl = page.url.prev;
const nextUrl = page.url.next;
---

<BaseLayout title={page.currentPage === 1 ? "Blog - The Hobbinomicon" : `Blog - Page ${page.currentPage} - The Hobbinomicon`}>
  <StructuredData
    type="breadcrumb"
    data={{
      breadcrumbs: [
        { name: 'Home', url: 'https://hobbinomicon.com/' },
        { name: 'Blog', url: 'https://hobbinomicon.com/blog' },
      ],
    }}
  />
  <Header theme="light" />

  <main id="main-content" class="min-h-screen bg-parchment dark:bg-parchment-dark">
    <PageHeader
      title="All Posts"
      description={page.currentPage === 1
        ? "Exploring hobbies, projects, and creative pursuits"
        : `Page ${page.currentPage} of ${page.lastPage}`}
      backLink={{ href: "/", text: "Back to Home" }}
    />

    <CategoryShortcuts categories={categories} />

    <!-- Posts Grid -->
    <ContentContainer class="py-16">
      <!-- Post Count -->
      <p class="text-ink/70 dark:text-ink-dark/70 text-sm mb-8">
        Showing {page.start + 1}-{page.end + 1} of {page.total} posts
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {page.data.map((post) => (
          <PostCard post={post} />
        ))}
      </div>

      <!-- Pagination -->
      <Pagination
        currentPage={page.currentPage}
        totalPages={page.lastPage}
        baseUrl={baseUrl}
        prevUrl={prevUrl}
        nextUrl={nextUrl}
      />
    </ContentContainer>

    <Footer />
  </main>
</BaseLayout>
