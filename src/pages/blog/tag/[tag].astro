---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection('blog');

  // Find all unique tags across all posts
  const tags = new Set();
  for (const post of posts) {
    post.data.tags.forEach((tag) => tags.add(tag));
  }

  return Array.from(tags).map((tag) => ({
    params: { tag },
  }));
}

const { tag } = Astro.params;
const posts = await getCollection('blog');
const taggedPosts = posts.filter((post) => post.data.tags.includes(tag));
---

<BaseLayout title={`Posts tagged "${tag}" | Hobbinomicon`}>
  <section class="py-12">
    <div class="max-w-7xl mx-auto px-4">
      
      <!-- Breadcrumbs -->
      <nav class="text-sm mb-6 text-gray-500">
        <a href="/" class="hover:text-red-600">Home</a> &rsaquo; 
        <a href="/blog" class="hover:text-red-600">Blog</a> &rsaquo;
        <span class="text-gray-900">{tag}</span>
      </nav>

      <h1 class="text-3xl md:text-4xl font-bold mb-8">Posts tagged with "{tag}"</h1>

      {taggedPosts.length > 0 ? (
        <div class="grid md:grid-cols-3 gap-6">
          {taggedPosts.map((post) => (
            <div class="border rounded-lg overflow-hidden shadow hover:shadow-lg transition p-4">
              <a href={`/blog/${post.slug}`} class="block">
                {post.data.featuredImage && (
                  <img src={post.data.featuredImage} alt={post.data.title} class="rounded mb-4" />
                )}
                <h2 class="text-xl font-semibold">{post.data.title}</h2>
                <p class="text-gray-500 text-sm mt-2">{new Date(post.data.pubDate).toLocaleDateString()}</p>
              </a>
            </div>
          ))}
        </div>
      ) : (
        <p>No posts found for this tag.</p>
      )}
    </div>
  </section>
</BaseLayout>
