---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import BlogPostCard from "../../../components/BlogPostCard.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const categories = new Set(posts.map(post => post.data.category));

  return Array.from(categories).map(category => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const posts = await getCollection('blog');
const categoryPosts = posts.filter(post => post.data.category === category);

// Capitalize first letter for prettier breadcrumb and SEO title
const categoryTitle = category.charAt(0).toUpperCase() + category.slice(1);
---

<BaseLayout title={`Category: ${categoryTitle} | Hobbinomicon`}>
  <section class="py-12">
    <div class="max-w-7xl mx-auto px-4">

      <!-- Breadcrumbs -->
      <nav class="text-sm mb-6 text-gray-500">
        <a href="/" class="hover:text-red-600">Home</a> &rsaquo; 
        <a href="/blog" class="hover:text-red-600">Blog</a> &rsaquo; 
        <span class="text-gray-900">{categoryTitle}</span>
      </nav>

      <!-- Category Title -->
      <h1 class="text-3xl font-bold mb-8">Category: {categoryTitle}</h1>

      {categoryPosts.length > 0 ? (
        <div class="grid md:grid-cols-3 gap-6">
          {categoryPosts.map((post) => (
            <BlogPostCard post={post} />
          ))}
        </div>
      ) : (
        <p>No posts found for this category.</p>
      )}
      
    </div>
  </section>
</BaseLayout>
