---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { supabase } from "../../lib/supabase";
import "../../styles/global.css";

export async function getStaticPaths() {
  const { data: stores, error } = await supabase
    .from('stores')
    .select('slug');

  if (error) {
    console.error('Error fetching store slugs:', error.message);
    return [];
  }

  return stores.map(store => ({
    params: { slug: store.slug },
  }));
}

const { slug } = Astro.params;

const { data: store, error } = await supabase
  .from('stores')
  .select('*')
  .eq('slug', slug)
  .single();

if (error) {
  console.error('Error fetching store:', error.message);
}
---

<BaseLayout title={store?.name || 'Store'}>
  <main class="max-w-4xl mx-auto p-6">
    {store ? (
      <>
        <h1 class="text-4xl font-bold mb-4">{store.name}</h1>
        <p class="mb-6">{store.description}</p>

        <div class="grid grid-cols-2 gap-6">
          <div><strong>Address:</strong> {store.address}</div>
          <div><strong>City:</strong> {store.city}</div>
          <div><strong>State:</strong> {store.state}</div>
          <div><strong>Zip Code:</strong> {store.zip_code}</div>
        </div>

        {store.website && (
          <div class="mt-6">
            <a href={store.website} target="_blank" class="text-primary hover:underline">Official Website</a>
          </div>
        )}
      </>
    ) : (
      <p>Store not found.</p>
    )}
  </main>
</BaseLayout>
