---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import { supabase } from "../../lib/supabase";
import StoreDetails from "../../components/StoreDetails.astro";

export async function getStaticPaths() {
  const { data: stores, error } = await supabase.from("stores").select("slug");

  if (error) {
    console.error("Failed to fetch stores:", error);
    return [];
  }

  return stores.map((store) => ({
    params: { slug: store.slug },
  }));
}

const { slug } = Astro.params;
const { data: store, error } = await supabase
  .from("stores")
  .select("*")
  .eq("slug", slug)
  .single();

if (error) {
  console.error("Failed to fetch store:", error);
}

const breadcrumbs = [
  { title: "Home", href: "/" },
  { title: "Stores", href: "/stores" },
  { title: store?.name || "Store" },
];
---
<BaseLayout>
  {store ? (
    <section class="py-8">
      <div class="max-w-7xl mx-auto px-4">
        <Breadcrumbs items={breadcrumbs} />
        <StoreDetails store={store} />
      </div>
    </section>
  ) : (
    <div class="text-center py-24">
      <h2 class="text-2xl font-bold">Store not found.</h2>
    </div>
  )}
</BaseLayout>
